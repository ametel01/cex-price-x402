# Docker Compose Setup Summary

## Files Created

### Docker Compose Files

1. **`docker-compose.yml`** - Production configuration
   - Multi-stage build from local Dockerfile
   - Environment variable configuration
   - Health checks every 30 seconds
   - Resource limits (512MB RAM, 1 CPU)
   - Automatic restart policy
   - Network isolation
   - Logging with rotation

2. **`docker-compose.dev.yml`** - Development overrides
   - Hot reload support
   - Volume mounts for source code
   - Debug port exposure (9229)
   - More verbose logging

3. **`Dockerfile.dev`** - Development Dockerfile
   - Includes all dependencies
   - Hot reload with `bun --hot`
   - Debug port enabled

4. **`.env.docker`** - Environment template for Docker
   - All required and optional variables
   - Documentation for each setting
   - Safe defaults

### Documentation

5. **`DOCKER.md`** - Comprehensive Docker guide
   - Quick start instructions
   - Docker Compose commands
   - Direct Docker usage
   - Environment variables reference
   - Networking configuration
   - Troubleshooting guide
   - CI/CD integration examples

## Quick Start

```bash
# 1. Configure environment
cp .env.docker .env
# Edit .env with your wallet address

# 2. Start the service
docker-compose up -d

# 3. View logs
docker-compose logs -f

# 4. Check health
curl http://localhost:8080/v1/health

# 5. Stop the service
docker-compose down
```

## Development Mode

```bash
# Start with hot reload
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# Code changes will automatically reload
```

## Features

✅ **Production-ready** - Optimized multi-stage Dockerfile
✅ **Secure** - Runs as non-root user (bun)
✅ **Health checks** - Automatic container health monitoring
✅ **Resource limits** - Prevents resource exhaustion
✅ **Logging** - Structured logs with rotation
✅ **Development mode** - Hot reload support
✅ **Network isolation** - Custom bridge network
✅ **Restart policy** - Automatic recovery from crashes

## Environment Variables

Required:

- `RESOURCE_WALLET_ADDRESS` - Your EVM wallet for payments
- `PORT` - Server port (default: 8080)
- `NETWORK` - Payment network (default: base-sepolia)
- `PAIRS` - Trading pairs to track

Optional:

- `PRIVATE_KEY` - For settlement operations
- `FACILITATOR_URL` - Custom facilitator URL
- `SPREAD_BPS_MAX` - Max spread tolerance
- `STALE_MS` - Max data staleness

## Architecture

```
┌─────────────────────────────────────┐
│   docker-compose.yml                │
│   ┌─────────────────────────────┐   │
│   │  cex-price-api container    │   │
│   │  ┌───────────────────────┐  │   │
│   │  │  Multi-stage build    │  │   │
│   │  │  1. deps              │  │   │
│   │  │  2. build             │  │   │
│   │  │  3. production        │  │   │
│   │  └───────────────────────┘  │   │
│   │  Port: 8080                 │   │
│   │  Network: cex-price-network │   │
│   │  Health: /v1/health         │   │
│   └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

## Troubleshooting

Common issues and solutions:

**Service won't start:**

```bash
docker-compose logs cex-price-api
# Check for missing environment variables
```

**Port already in use:**

```bash
# Edit docker-compose.yml to use different port
ports:
  - "8081:8080"  # HOST:CONTAINER
```

**Health check failing:**

```bash
docker exec cex-price-x402 curl http://localhost:8080/v1/health
```

## Next Steps

1. ✅ Configure `.env` file with your settings
2. ✅ Start the service with `docker-compose up -d`
3. ✅ Verify it's running: `curl http://localhost:8080/v1/health`
4. ✅ Check logs: `docker-compose logs -f`
5. ✅ Test endpoints (see main README.md)

For detailed documentation, see:

- [DOCKER.md](DOCKER.md) - Complete Docker guide
- [README.md](README.md) - API documentation
- [.github/README.md](.github/README.md) - CI/CD documentation
